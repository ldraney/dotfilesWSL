name: Pre-release to staging
on:
  workflow_call:
    inputs:
      environment: 
        required: true
        type: string
      git-tag:
        required: true
        type: string

jobs:
  setup-environment:
    runs-on: ubuntu-latest
    outputs:
      git-tag: ${{ steps.tag.outputs.version }}
    steps:
      - name: Init
        run: |
          echo Deploy starting
          # this allows for blame
          echo ${{ github.actor }}
  deploy-to-staging:
    needs: [setup-environment]
    uses: ./.github/workflows/deployment.yml
    with:
      environment: "${{ inputs.environment }}"
      ref: "${{ inputs.git-tag }}"
