name: Release Trigger
on:
  release:
    types: [released]

jobs:
  setup-release:
    runs-on: ubuntu-latest
    outputs:
      git-tag: ${{ steps.tag.outputs.version }}
      env: ${{ steps.setup.outputs.environment }}
    steps:
      - name: Check release
        run: |
          echo "Release tag: ${{ github.event.release.tag_name }}"
          echo "Release name: ${{ github.event.release.name }}"
          echo "github.event.release.prerelease: ${{ github.event.release.prerelease }}"
          echo "github.event.release.isPrerelease: ${{ github.event.release.isPrerelease }}"
          echo "github.event.action: ${{ github.event.action }}"
          echo "github.event.release.release: ${{ github.event.release.release }}"
          echo "github.event.release: ${{ github.event.release }}"

      - name: Setup Environment
        id: setup
        uses: actions/github-script@v6
        with:
          script: |
            if ('${{ github.event.action }}' === 'released') {
              core.setOutput('environment', 'prod')
            }

  run-lambda-deploy:
    needs: [setup-release]
    run: |
      echo " the environment is ${{ needs.setup-release.outputs.env }}"
